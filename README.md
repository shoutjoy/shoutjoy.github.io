# 🎥 ezlive - 교육용 P2P 화상 강의 플랫폼

WebRTC와 PeerJS를 활용한 브라우저 기반 1:1 화상 강의 애플리케이션입니다.

## 📋 프로젝트 개요

ezlive는 교사와 학생 간의 직접 연결을 통해 화상 통화와 채팅을 제공하는 교육용 웹 애플리케이션입니다. 서버 없이 P2P 방식으로 작동하여 간편하게 사용할 수 있습니다.

## ✨ 주요 기능

### 현재 구현된 기능

✅ **교육용 UI** ⭐ NEW
- 교사용 화상강의 생성
- 학생용 강의참여
- 교사 비밀번호 인증 (클라이언트 검증)
- 강의 코드 공유 시스템

✅ **화상 통화 기능**
- 실시간 비디오 스트리밍
- 교사/학생 화면 표시
- 비디오 on/off 토글
- 마이크 on/off 토글
- 통화 종료 기능

✅ **PIP (Picture-in-Picture)** ⭐ NEW
- 상대방 화면 PIP 모드
- 내 화면 PIP 모드
- 다른 작업 중에도 영상 시청 가능
- 브라우저 네이티브 PIP 지원
- **비디오 최대화/최소화 토글** ⭐ NEW
  - 그리드 레이아웃 내에서 비디오 크기 조절
  - 한 화면을 2배로 확대하여 집중 시청

✅ **화면 공유 기능**
- 전체 화면 공유 지원
- 특정 창/탭 선택 공유
- 실시간 화면 전환
- 화면 공유 중 오디오 유지
- 원클릭 카메라 복귀
- 전체화면 보기 모드

✅ **텍스트 채팅** ⭐ IMPROVED
- 실시간 메시지 전송
- 메시지 타임스탬프 표시
- 보낸 메시지/받은 메시지 구분
- 채팅 기록 CSV 다운로드
- **채팅 전체화면 모드** ⭐ NEW
- 채팅 새창 팝업 기능
- 입력란 상단 배치
- **파일 전송 기능** ⭐ NEW (최대 100MB)

✅ **전체화면 기능** ⭐ IMPROVED
- 비디오 전체화면 보기 (상대방/내 화면 각각)
- 전체화면 중 채팅 우측 고정 (400px)
- ESC 키로 나가기
- 채팅과 함께 동시 사용 가능

✅ **UI/UX 개선** ⭐ MAJOR UPDATE
- **컨트롤 바를 헤더 아래로 이동**
- **모든 버튼에 텍스트 레이블 표시**
  - 비디오 🎥
  - 마이크 🎤
  - 화면공유 🖥️
  - 채팅저장 💾
  - LMS 바로가기 🎓
  - 종료 ❌
- 채팅 입력란 상단 배치
- 1:1 비율 비디오 그리드 레이아웃
- 파일전송 버튼 텍스트 표시

✅ **P2P 연결**
- PeerJS를 통한 WebRTC 연결
- STUN 서버를 통한 NAT 통과
- 자동 Peer ID 생성
- 연결 코드 복사 기능

✅ **반응형 디자인**
- 모바일/태블릿/데스크톱 최적화
- 모바일 전용 슬라이드업 채팅창
- 터치 친화적 UI

## 🚀 사용 방법

### 교사용 - 강의 생성

1. **교사 비밀번호 입력**: `a123456!` 입력
2. **강의 생성** 버튼 클릭
3. 생성된 **강의 코드** 복사
4. 학생들에게 강의 코드 공유
5. 학생의 접속 대기
6. 연결되면 자동으로 화상 강의 시작

⚠️ **보안 주의**: 비밀번호는 클라이언트 측에서만 검증되며, 개발자 도구로 우회 가능합니다. 진짜 보안이 필요하면 서버 기반 시스템이 필요합니다.

### 학생용 - 강의 참여

1. 교사에게 받은 **강의 코드** 입력
2. **강의 참여** 버튼 클릭
3. 카메라/마이크 권한 허용
4. 자동으로 교사와 연결되어 강의 시작

### 화상 강의 중

**헤더 아래 컨트롤 바:**
- **📹 비디오**: 카메라 on/off
- **🎤 마이크**: 마이크 on/off
- **🖥️ 화면공유**: 화면/창 공유 시작/중지
- **💾 채팅저장**: 채팅 기록 CSV 다운로드
- **🎓 LMS**: LMS 사이트 바로가기 (https://www.ezlive.kr/)
- **❌ 종료**: 통화 종료

**비디오 화면:**
- **1:1 비율**: 상대방 화면과 내 화면이 동일한 크기로 표시
- **🖼️ PIP**: Picture-in-Picture 모드 (각 화면마다)
- **⤢ 최대화**: 그리드 내에서 비디오 2배 확대
- **⛶️ 전체화면**: 화면 전체를 사용하여 보기 (각 화면마다)

**채팅 기능:**
- **입력란**: 채팅 화면 상단에 배치
- **파일전송**: 이미지, 문서 등 파일 공유 (최대 100MB)
- **⛶️ 전체화면**: 채팅을 전체화면으로 확대
- **🗗️ 새창**: 채팅을 별도 창으로 팝업

## 🎮 주요 기능 사용법

### PIP (Picture-in-Picture) 모드

1. 상대방 화면 또는 내 화면의 **🖼️** 버튼 클릭
2. 브라우저가 PIP 창 생성
3. 다른 작업하면서 영상 계속 시청
4. PIP 창 닫거나 버튼 다시 클릭하면 종료

**활용:**
- 다른 자료 보면서 강의 시청
- 문서 작업하면서 화상 회의
- 멀티태스킹 환경에서 효율적

### 채팅 전체화면 모드

1. 채팅 헤더의 **⛶️** 버튼 클릭
2. 채팅이 전체 화면으로 확대
3. 대화 내용을 크게 보기
4. **⊎** 버튼이나 **ESC** 키로 복귀

**활용:**
- 긴 대화 내용 한눈에 보기
- 채팅 기록 검토
- 화면 녹화 시 채팅만 크게

### 비디오 전체화면 + 채팅

1. 비디오 화면의 **⛶️** 버튼으로 전체화면
2. 우측 하단에 **💬** 버튼 자동 표시
3. 💬 버튼 클릭하면 채팅 전체화면 열림
4. 전체화면 상태에서 채팅 가능

**활용:**
- 프레젠테이션 전체화면 중 Q&A
- 강의 화면 집중하면서 채팅 확인

## 📁 파일 구조

```
ezlive/
├── index.html          # 메인 HTML 파일
├── css/
│   └── style.css       # 스타일시트
├── js/
│   └── app.js          # 애플리케이션 로직
└── README.md           # 프로젝트 문서
```

## 🛠 기술 스택

- **HTML5**: 시맨틱 마크업
- **CSS3**: 반응형 디자인, 그라디언트, 애니메이션
- **JavaScript (ES6+)**: 클래스 기반 구조
- **PeerJS 1.5.2**: WebRTC 래퍼 라이브러리
- **WebRTC**: 실시간 통신 (비디오, 오디오, 데이터)
- **Picture-in-Picture API**: PIP 기능

## 📱 브라우저 요구사항

### 기본 기능
- Chrome/Edge 74+
- Firefox 66+
- Safari 12+

### PIP 지원
- Chrome/Edge 70+
- Safari 13.1+
- Firefox 97+ (실험적)

### 필수 권한
- 카메라 접근 권한
- 마이크 접근 권한

## ⚠️ 제한사항 및 주의사항

### 기술적 제한
- **1:1 전용**: 현재는 교사-학생 1:1 연결만 지원 (다중 연결 불가)
- **P2P 연결**: 서버를 거치지 않으므로 일부 방화벽 환경에서 연결 어려움
- **네트워크 환경**: Symmetric NAT 환경에서는 TURN 서버 필요
- **화면 공유**: 모바일 브라우저에서는 제한적

### 보안 주의사항
- **교사 비밀번호**: 클라이언트 측 검증으로 진짜 보안 아님
- **소스코드 노출**: JavaScript에 하드코딩되어 개발자 도구로 확인 가능
- **우회 가능**: 기술적으로 숙련된 사용자는 우회 가능
- **교육/데모용**: 실제 보안이 필요한 환경에서는 서버 기반 시스템 권장

### 권장사항
진짜 보안과 다중 사용자가 필요하다면:
- Node.js + Express 서버
- 데이터베이스 (사용자 인증)
- WebRTC 시그널링 서버
- TURN 서버 (방화벽 통과)

## 🔒 보안 및 프라이버시

- **P2P 연결**: 모든 통신은 브라우저 간 직접 연결
- **암호화**: WebRTC 내장 암호화 (DTLS/SRTP)
- **서버 미경유**: 비디오/오디오 데이터는 서버를 거치지 않음
- **세션 관리**: 페이지 새로고침 시 연결 초기화
- **클라이언트 검증**: 교사 비밀번호는 간단한 확인용

## 💡 활용 사례

### 1. 1:1 과외/튜터링
- 교사가 강의 생성 후 학생 1명과 연결
- 화면 공유로 자료 설명
- 채팅으로 보충 설명
- PIP로 학생 반응 확인하며 작업

### 2. 원격 상담
- 상담사가 강의 생성
- 내담자가 코드로 참여
- 전체화면으로 집중 상담
- 채팅 기록 CSV 저장

### 3. 멘토링 세션
- 멘토가 화면 공유로 시연
- 멘티는 PIP로 화면 보며 실습
- 채팅으로 질문과 답변
- 세션 기록 CSV 저장

### 4. 온라인 발표 연습
- 발표자가 슬라이드 공유
- 피드백 제공자가 채팅으로 코멘트
- 전체화면으로 발표 연습
- 피드백 내역 CSV 저장

## 📊 데이터 모델

### PeerJS Connection
```javascript
{
    peer: string,          // 원격 peer ID
    open: boolean,         // 연결 상태
    metadata: object       // 연결 메타데이터
}
```

### Chat Message
```javascript
{
    type: string,          // 'sent' 또는 'received'
    message: string,       // 메시지 내용
    timestamp: string,     // 전송 시간 (HH:MM)
    fullTimestamp: string  // ISO 8601 형식 전체 시간
}
```

### CSV Export Format
```csv
시간,보낸사람,메시지
"14:30","나","안녕하세요"
"14:31","상대방","반갑습니다"
```

## 🎯 향후 개발 계획

### 파일 전송 사용법

1. 채팅 입력란 왼쪽의 **파일전송** 버튼 클릭
2. 전송할 파일 선택 (최대 100MB)
3. 자동으로 파일 전송
4. 상대방은 다운로드 버튼으로 파일 저장

**지원 파일:**
- 이미지: JPG, PNG, GIF 등
- 문서: PDF, Word, Excel, PowerPoint
- 압축: ZIP, RAR
- 동영상: MP4, AVI (용량 제한 내)
- 기타: 모든 파일 형식

**제한사항:**
- 최대 파일 크기: 100MB
- P2P 전송으로 서버 미경유
- 연결 종료 시 파일 이력 삭제
- 대용량 파일은 전송 시간이 소요될 수 있음

## 🎯 향후 개발 계획

### 미구현 기능

- [ ] **다중 사용자**: 3명 이상 동시 연결 (서버 필요)
- [ ] **진짜 인증 시스템**: 데이터베이스 기반 사용자 관리
- [ ] **강의실 룸**: 여러 강의실 동시 운영
- [ ] **대용량 파일 전송**: 100MB 이상 파일 (청크 전송)
- [ ] **녹화 기능**: MediaRecorder API 활용
- [ ] **화이트보드**: 실시간 협업 그리기
- [ ] **손들기 기능**: 학생 질문 신호
- [ ] **출석 체크**: 참여 시간 기록
- [ ] **배경 효과**: 가상 배경, 블러

### 추천 다음 단계

1. **TURN 서버 추가**: 방화벽 환경 지원
2. **서버 기반 시스템**: 진짜 인증과 다중 사용자
3. **녹화 기능**: 강의 내용 저장
4. **파일 공유**: 자료 전송
5. **화이트보드**: 판서 기능

## 🚀 배포

웹사이트를 온라인으로 배포하려면 **Publish 탭**으로 이동하여 원클릭 배포하세요!

## 💻 개발 참고사항

### 로컬 테스트
- HTTPS 또는 localhost 환경 필요 (WebRTC/PIP 보안 요구사항)
- 두 개의 브라우저 탭 또는 다른 기기에서 테스트

### 디버깅
- 브라우저 개발자 도구 콘솔에서 연결 상태 확인
- PeerJS 이벤트 로그 확인

## 📄 라이선스

이 프로젝트는 교육 및 개인 사용 목적으로 제작되었습니다.

## 🙏 크레딧

- **PeerJS**: WebRTC 래퍼 라이브러리
- **Google STUN Servers**: NAT 통과 지원
- **WebRTC**: 실시간 통신 기술
- **Picture-in-Picture API**: 브라우저 PIP 기능

---

**제작일**: 2025-11-09  
**버전**: 2.1.1  
**개발자**: ezlive Team  
**용도**: 교육용 1:1 화상 강의 플랫폼

---

## 🔧 버전 2.1.1 변경사항

### 버그 수정
- ✅ 파일 전송 기능 오류 수정
- ✅ 채팅 전체화면 모드 오류 수정
- ✅ 채팅 새창 열기 기능 오류 수정
- ✅ PIP 모드 오류 수정
- ✅ 비디오 최대화/최소화 오류 수정
- ✅ JavaScript null reference 오류 수정
- ✅ 모든 버튼에 null 체크 추가 (안정성 향상)
