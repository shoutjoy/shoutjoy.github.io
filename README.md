# 🎥 ezlive - 교육용 P2P 화상 강의 플랫폼

WebRTC와 PeerJS를 활용한 브라우저 기반 1:1 화상 강의 애플리케이션입니다.

## 📋 프로젝트 개요

ezlive는 교사와 학생 간의 직접 연결을 통해 화상 통화와 채팅을 제공하는 교육용 웹 애플리케이션입니다. 서버 없이 P2P 방식으로 작동하여 간편하게 사용할 수 있습니다.

## ✨ 주요 기능

### 현재 구현된 기능

✅ **교육용 UI** ⭐ MAJOR UPDATE
- 교사용 화상강의 생성
- 학생용 강의참여
- **교사/학생 이름 입력** ⭐ NEW
- 교사 비밀번호 인증 (클라이언트 검증)
- **강의 코드 시스템** ⭐ ENHANCED
  - 고정 강의 코드 입력 (같은 코드로 항상 접속)
  - 빈칸으로 두면 자동 랜덤 생성 (8자리)
  - 중복 코드 자동 감지 및 경고
  - **localStorage 자동 저장**: 이전 사용 정보 자동 불러오기
- **초대링크 기능** ⭐ NEW
  - 원클릭 초대링크 생성
  - 강의 코드 입력 생략
  - 학생 이름만 입력하고 바로 참여
  - URL query parameter 기반 (invitation-code)

✅ **화상 통화 기능**
- 실시간 비디오 스트리밍
- 교사/학생 화면 표시
- 비디오 on/off 토글
- 마이크 on/off 토글
- 통화 종료 기능

✅ **PIP (Picture-in-Picture)** ⭐ NEW
- 상대방 화면 PIP 모드
- 내 화면 PIP 모드
- 다른 작업 중에도 영상 시청 가능
- 브라우저 네이티브 PIP 지원
- **비디오 최대화/최소화 토글** ⭐ NEW
  - 그리드 레이아웃 내에서 비디오 크기 조절
  - 한 화면을 2배로 확대하여 집중 시청

✅ **화면 공유 기능** ⭐ MAJOR UPDATE
- 전체 화면 공유 지원
- 특정 창/탭 선택 공유
- 실시간 화면 전환
- 화면 공유 중 오디오 유지
- 원클릭 카메라 복귀
- 전체화면 보기 모드
- **학생 화면공유 승인 시스템** ⭐ NEW
  - 학생이 화면공유 시 교사에게 자동 요청
  - 교사가 승인/거부 결정
  - 승인 후 화면공유 시작
- **화면공유 시작/종료 알림** ⭐ NEW
  - 채팅에 화면공유 시작/종료 시스템 메시지
  - 상대방에게도 알림 전송
- **판서 기능** ⭐ ENHANCED
  - **수동 실행**: 판서 버튼을 눌러야 활성화 (자동 실행 X)
  - **새창 모드**: 판서 도구를 별도 팝업 창으로 띄우기
  - **포인터 기능**: 붉은 점 포인터로 강조 표시
  - 화면공유 중 실시간 그리기
  - 색상 선택, 굵기 조절
  - 펜/지우개/포인터 모드 전환
  - 전체 삭제 기능
  - 전체화면/최대화에서도 항상 사용 가능

✅ **텍스트 채팅** ⭐ IMPROVED
- 실시간 메시지 전송
- 메시지 타임스탬프 표시
- 보낸 메시지/받은 메시지 구분
- 채팅 기록 CSV 다운로드
- **채팅 전체화면 모드** ⭐ NEW
- 채팅 새창 팝업 기능
- 입력란 상단 배치
- **파일 전송 기능** ⭐ NEW (최대 100MB)

✅ **전체화면 기능** ⭐ IMPROVED
- 비디오 전체화면 보기 (상대방/내 화면 각각)
- 전체화면 중 채팅 우측 고정 (400px)
- ESC 키로 나가기
- 채팅과 함께 동시 사용 가능

✅ **녹화 기능** ⭐ NEW
- **원클릭 녹화**: 브라우저에서 직접 녹화
- **화면 + 음성**: 화면과 마이크 오디오 동시 녹화
- **WebM 포맷**: 고화질 영상 (2.5Mbps)
- **자동 저장**: 다운로드 폴더에 자동 저장
- **실시간 표시**: 녹화 중 버튼 깜빡임 효과
- **채팅 알림**: 녹화 시작/중지 시스템 메시지

✅ **UI/UX 개선** ⭐ MAJOR UPDATE
- **컨트롤 바를 헤더 아래로 이동**
- **모든 버튼에 텍스트 레이블 표시**
  - 비디오 🎥
  - 마이크 🎤
  - 화면공유 🖥️
  - **판서** ✏️ ⭐ NEW (화면공유 중에만 표시)
  - **채팅창 토글** 💬 ⭐ NEW
  - 채팅저장 💾
  - LMS 바로가기 🎓
  - **다시보기** 🔄 ⭐ NEW
  - **녹화** ⏺️ ⭐ NEW
  - **녹화폴더** 📁 ⭐ NEW
  - 종료 ❌
- **비디오 화면에 실제 이름 표시** ⭐ NEW
- **채팅에 이름 표시** ⭐ NEW
- 채팅 입력란 상단 배치
- 1:1 비율 비디오 그리드 레이아웃
- 파일전송 버튼 텍스트 표시

✅ **P2P 연결**
- PeerJS를 통한 WebRTC 연결
- STUN 서버를 통한 NAT 통과
- 자동 Peer ID 생성
- 연결 코드 복사 기능

✅ **종료 시 채팅 저장** ⭐ NEW
- 통화 종료 시 채팅 저장 확인 모달
- 저장하고 종료 / 종료만 / 취소 선택 가능
- CSV 형식으로 자동 다운로드

✅ **반응형 디자인** ⭐ MAJOR UPDATE
- 모바일/태블릿/데스크톱 완벽 최적화
- 모바일 전용 슬라이드업 채팅창
- 터치 친화적 UI
- **모바일 컨트롤 바**: 가로 스크롤 버튼
- **모바일 비디오 레이아웃**: 세로 스택
- **모바일 전체화면**: 채팅창 하단 고정
- **비디오 자동재생 처리**: 모바일 정책 대응

## 📱 모바일 사용 가이드

### 모바일 접속 방법

**카카오톡/네이버 등 인앱 브라우저 사용 시:**
- ⚠️ 자동으로 외부 브라우저(Chrome/Safari) 열기 안내 표시
- iOS: Safari로 열기 안내
- Android: 자동으로 Chrome 실행

**권장 브라우저:**
- 📱 iOS: Safari
- 📱 Android: Chrome

### 모바일 최적화 기능

**컨트롤 바:**
- 👆 좌우 스와이프로 버튼 탐색
- 가로 스크롤로 모든 버튼 접근
- 아이콘 + 텍스트 레이블 표시

**비디오 화면:**
- 📺 세로 스택 레이아웃 (상대방 위, 나 아래)
- 16:9 비율 자동 조절
- 전체화면 시 100% 확대

**채팅창:**
- 👆 채팅 헤더 탭하여 열기/닫기
- 하단에서 슬라이드업 애니메이션
- 접힌 상태에서도 일부 보임 (60px)
- 전체화면 시 하단 40vh 고정

**판서 도구:**
- 화면공유 중 하단 우측에 표시
- 터치로 그리기 지원
- 색상/굵기 조절 가능

**화면공유 (모바일):** ⭐ NEW
- iOS Safari, Android Chrome 지원
- 모바일 기기 화면 공유 가능
- 앱 화면, 게임 화면 등 공유

**녹화 (모바일):** ⭐ NEW
- 모바일 기기에서 화면 녹화
- 시스템 오디오 캡처 시도
- WebM 형식으로 저장

**비디오 자동재생:**
- 일부 모바일 브라우저에서 자동재생 제한
- 재생 버튼이 나타나면 탭하여 시작

## 🚀 사용 방법

### 교사용 - 강의 생성

1. **교사 이름 입력**: 예) "김선생님"
2. **교사 비밀번호 입력**: `a123456!` 입력
3. **강의 코드 입력** (선택사항):
   - **고정 코드 사용**: 예) "math2024" → 항상 같은 코드로 강의 가능
   - **비워두기**: 랜덤 코드 자동 생성 (8자리)
   - 💡 한 번 사용한 정보는 자동 저장되어 다음에 자동 입력됨
4. **강의 생성** 버튼 클릭
5. 2가지 공유 방법 선택:
   - **강의 코드**: 학생이 코드를 입력해야 함
   - **초대 링크** ⭐ 추천: 클릭만으로 간편하게 참여
6. 학생의 접속 대기
7. 연결되면 자동으로 화상 강의 시작

💡 **TIP**: 고정 강의 코드를 사용하면 매일 같은 코드로 강의를 열 수 있어 편리합니다!

⚠️ **보안 주의**: 비밀번호는 클라이언트 측에서만 검증되며, 개발자 도구로 우회 가능합니다. 진짜 보안이 필요하면 서버 기반 시스템이 필요합니다.

### 학생용 - 강의 참여

**방법1: 초대링크 사용** ⭐ 추천
1. 교사가 공유한 **초대링크** 클릭
2. 자동으로 강의 참여 페이지 열림
3. **학생 이름만 입력**: 예) "홍길동"
4. **강의 참여** 버튼 클릭
5. 카메라/마이크 권한 허용
6. 자동으로 교사와 연결되어 강의 시작

**방법2: 강의 코드 입력** (기존 방식)
1. ezlive 홈페이지 접속
2. **학생 이름 입력**: 예) "홍길동"
3. 교사에게 받은 **강의 코드** 입력
4. **강의 참여** 버튼 클릭
5. 카메라/마이크 권한 허용
6. 자동으로 교사와 연결되어 강의 시작

### 화상 강의 중

**헤더 아래 컨트롤 바:**
- **📹 비디오**: 카메라 on/off
- **🎤 마이크**: 마이크 on/off
- **🖥️ 화면공유**: 화면/창 공유 시작/중지
  - 교사: 즉시 화면공유 시작
  - 학생: 교사에게 승인 요청 → 승인 후 시작
  - 모바일: 기기 화면 공유 가능
- **✏️ 판서도구**: 화이트보드 열기/닫기 (독립 기능)
  - 새창으로 화이트보드 표시
  - 실시간으로 상대방에게 공유
  - 화면공유 없이도 사용 가능
- **✏️ 판서 (화면공유 중)**: 화면 위에 직접 그리기
  - 화면공유 시작 시 자동 표시
  - 판서만 끄고 화면공유 유지 가능
- **💬 채팅창**: 채팅창 열기/닫기
- **💾 채팅저장**: 채팅 기록 CSV 다운로드
- **🎓 LMS**: LMS 사이트 바로가기 (https://www.ezlive.kr/)
- **🔄 다시보기**: 다시보기 사이트 (https://jlive.co.kr/)
- **❌ 종료**: 통화 종료

**비디오 화면:**
- **1:1 비율**: 상대방 화면과 내 화면이 동일한 크기로 표시
- **실제 이름 표시**: 교사명/학생명이 화면에 표시됨
- **🖼️ PIP**: Picture-in-Picture 모드 (각 화면마다)
- **⤢ 최대화**: 그리드 내에서 비디오 2배 확대
- **⛶️ 전체화면**: 화면 전체를 사용하여 보기 (각 화면마다)

**채팅 기능:**
- **입력란**: 채팅 화면 상단에 배치
- **이름 표시**: 각 메시지에 보낸 사람 이름 표시
- **파일전송**: 이미지, 문서 등 파일 공유 (최대 100MB)
- **⛶️ 전체화면**: 채팅을 전체화면으로 확대
- **🗗️ 새창**: 채팅을 별도 창으로 팝업
- **토글**: 채팅창을 닫았다 다시 열 수 있음

## 🎮 주요 기능 사용법

### PIP (Picture-in-Picture) 모드

1. 상대방 화면 또는 내 화면의 **🖼️** 버튼 클릭
2. 브라우저가 PIP 창 생성
3. 다른 작업하면서 영상 계속 시청
4. PIP 창 닫거나 버튼 다시 클릭하면 종료

**활용:**
- 다른 자료 보면서 강의 시청
- 문서 작업하면서 화상 회의
- 멀티태스킹 환경에서 효율적

### 채팅 전체화면 모드

1. 채팅 헤더의 **⛶️** 버튼 클릭
2. 채팅이 전체 화면으로 확대
3. 대화 내용을 크게 보기
4. **⊎** 버튼이나 **ESC** 키로 복귀

**활용:**
- 긴 대화 내용 한눈에 보기
- 채팅 기록 검토
- 화면 녹화 시 채팅만 크게

### 비디오 전체화면 + 채팅

1. 비디오 화면의 **⛶️** 버튼으로 전체화면
2. 우측 하단에 **💬** 버튼 자동 표시
3. 💬 버튼 클릭하면 채팅 전체화면 열림
4. 전체화면 상태에서 채팅 가능

**활용:**
- 프레젠테이션 전체화면 중 Q&A
- 강의 화면 집중하면서 채팅 확인

## 📁 파일 구조

```
ezlive/
├── index.html          # 메인 HTML 파일
├── css/
│   └── style.css       # 스타일시트 (반응형 디자인 포함)
├── js/
│   └── app.js          # 애플리케이션 로직
└── README.md           # 프로젝트 문서
```

## 🛠 기술 스택

- **HTML5**: 시맨틱 마크업, video 태그 (playsinline 속성)
- **CSS3**: 반응형 디자인 (@media queries), 그라디언트, 애니메이션
- **JavaScript (ES6+)**: 클래스 기반 구조
- **PeerJS 1.5.2**: WebRTC 래퍼 라이브러리
- **WebRTC**: 실시간 통신 (비디오, 오디오, 데이터)
- **Picture-in-Picture API**: PIP 기능
- **MediaRecorder API**: 화면 녹화 기능
- **Canvas API**: 판서 기능

## 📱 브라우저 요구사항

### 데스크톱 권장 브라우저
- ✅ **Chrome/Edge 74+** (최고의 호환성)
- ✅ **Firefox 66+**
- ✅ **Safari 12+**

### 모바일 권장 브라우저
- ✅ **iOS Safari 12+** (필수)
- ✅ **Android Chrome 74+** (필수)
- ⚠️ Samsung Internet (제한적)

### PIP 지원
- Chrome/Edge 70+
- Safari 13.1+
- Firefox 97+ (실험적)
- ❌ 모바일: PIP 제한적 (브라우저별 상이)

### 필수 권한
- 📷 카메라 접근 권한
- 🎤 마이크 접근 권한
- 🔊 자동재생 권한 (모바일)

### ⚠️ 지원하지 않는 브라우저
- ❌ **카카오톡 인앱 브라우저**
- ❌ **네이버 앱 브라우저**
- ❌ **페이스북 인앱 브라우저**
- ❌ **인스타그램 인앱 브라우저**
- ❌ **라인 인앱 브라우저**
- ❌ 기타 인앱 브라우저

**→ 위 브라우저에서 접속 시 자동으로 외부 브라우저 열기 안내**
- iOS: Safari 열기 가이드 표시
- Android: Chrome 자동 실행 (intent:// scheme)

## ⚠️ 제한사항 및 주의사항

### 기술적 제한
- **1:1 전용**: 현재는 교사-학생 1:1 연결만 지원 (다중 연결 불가)
- **P2P 연결**: 서버를 거치지 않으므로 일부 방화벽 환경에서 연결 어려움
- **네트워크 환경**: Symmetric NAT 환경에서는 TURN 서버 필요
- **화면 공유**: 모바일 브라우저에서는 제한적 (iOS Safari는 미지원)
- **녹화 기능**: 모바일에서 화면 녹화 제한적
- **비디오 자동재생**: 모바일 브라우저 정책에 따라 사용자 터치 필요

### 보안 주의사항
- **교사 비밀번호**: 클라이언트 측 검증으로 진짜 보안 아님
- **소스코드 노출**: JavaScript에 하드코딩되어 개발자 도구로 확인 가능
- **우회 가능**: 기술적으로 숙련된 사용자는 우회 가능
- **교육/데모용**: 실제 보안이 필요한 환경에서는 서버 기반 시스템 권장

### 권장사항
진짜 보안과 다중 사용자가 필요하다면:
- Node.js + Express 서버
- 데이터베이스 (사용자 인증)
- WebRTC 시그널링 서버
- TURN 서버 (방화벽 통과)

## 🔒 보안 및 프라이버시

- **P2P 연결**: 모든 통신은 브라우저 간 직접 연결
- **암호화**: WebRTC 내장 암호화 (DTLS/SRTP)
- **서버 미경유**: 비디오/오디오 데이터는 서버를 거치지 않음
- **세션 관리**: 페이지 새로고침 시 연결 초기화
- **클라이언트 검증**: 교사 비밀번호는 간단한 확인용

## 💡 활용 사례

### 1. 1:1 과외/튜터링
- 교사가 강의 생성 후 학생 1명과 연결
- 화면 공유로 자료 설명
- 채팅으로 보충 설명
- PIP로 학생 반응 확인하며 작업

### 2. 원격 상담
- 상담사가 강의 생성
- 내담자가 코드로 참여
- 전체화면으로 집중 상담
- 채팅 기록 CSV 저장

### 3. 멘토링 세션
- 멘토가 화면 공유로 시연
- 멘티는 PIP로 화면 보며 실습
- 채팅으로 질문과 답변
- 세션 기록 CSV 저장

### 4. 온라인 발표 연습
- 발표자가 슬라이드 공유
- 피드백 제공자가 채팅으로 코멘트
- 전체화면으로 발표 연습
- 피드백 내역 CSV 저장

## 📊 데이터 모델

### PeerJS Connection
```javascript
{
    peer: string,          // 원격 peer ID
    open: boolean,         // 연결 상태
    metadata: object       // 연결 메타데이터
}
```

### Chat Message
```javascript
{
    type: string,          // 'sent' 또는 'received'
    message: string,       // 메시지 내용
    timestamp: string,     // 전송 시간 (HH:MM)
    fullTimestamp: string  // ISO 8601 형식 전체 시간
}
```

### CSV Export Format
```csv
시간,보낸사람,메시지
"14:30","나","안녕하세요"
"14:31","상대방","반갑습니다"
```

## 💡 모바일 사용 팁

### 📱 성능 최적화
- 안정적인 Wi-Fi 연결 권장
- 모바일 데이터 사용 시 데이터 소모 주의
- 배터리 충분한지 확인 (영상통화는 배터리 소모가 큼)

### 🎥 화질 및 연결
- 조명이 밝은 곳에서 사용
- 카메라 렌즈 청소
- 연결 불안정 시 Wi-Fi 재연결

### 🔊 오디오
- 이어폰/헤드셋 사용 권장 (에코 방지)
- 조용한 환경에서 사용
- 마이크 권한 허용 필수

### 👆 터치 조작
- 컨트롤 바: 좌우 스와이프
- 채팅창: 헤더 탭하여 열기/닫기
- 판서: 터치로 그리기
- 전체화면: 탭하여 토글

### 🔄 문제 해결
- 화면이 검게 나오면: 권한 확인
- 비디오가 재생 안 되면: 화면 탭하여 수동 재생
- 채팅이 안 보이면: 채팅 헤더 탭
- 연결이 끊기면: 새로고침 후 재접속

## 🎯 향후 개발 계획

### 화면공유 승인 시스템 (학생용)

학생이 화면을 공유하려면 교사의 승인이 필요합니다:

**학생 절차:**
1. **🖥️ 화면공유** 버튼 클릭
2. 교사에게 자동으로 승인 요청 전송
3. 교사의 승인 대기
4. 승인되면 화면 선택 창 표시
5. 공유할 화면/창/탭 선택
6. 화면공유 시작

**교사 절차:**
1. 학생의 화면공유 요청 모달 표시
2. 학생 이름과 요청 내용 확인
3. **✅ 승인** 또는 **❌ 거부** 선택
4. 승인 시 학생의 화면이 공유됨
5. 거부 시 학생에게 알림 전송

**주의사항:**
- 교사는 승인 없이 즐시 화면공유 가능
- 학생은 반드시 교사의 승인 필요
- 채팅창에 승인/거부 내역 표시

### 화이트보드 기능 사용법 ⭐ NEW

화이트보드는 독립적인 판서 공간으로 화면공유 없이도 사용할 수 있습니다:

**화이트보드 시작:**
1. 컨트롤 바에서 **✏️ 판서도구** 버튼 클릭
2. 1200x800 크기의 화이트보드 새창 열림
3. 자동으로 화이트보드가 상대방에게 공유됨
4. 실시간으로 그리기 가능

**화이트보드 도구:**
- **🖊️ 펜**: 자유롭게 그리기 (기본 검은색)
- **🧹 지우개**: 그린 내용 지우기 (배경은 유지)
- **🔴 포인터**: 화살표로 특정 위치 가리키기
- **색상**: 컬러 픽커로 펜 색상 변경
- **굵기**: 슬라이더로 선 굵기 조절 (1~20px)
- **🗑️ 전체삭제**: 화이트보드 전체 지우기

**화이트보드 종료:**
- 화이트보드 창 닫기 또는
- **✏️ 판서도구** 버튼 다시 클릭

**활용:**
- 수학 문제 풀이 (깨끗한 배경에서)
- 다이어그램 그리기
- 브레인스토밍
- 개념 설명
- 화면공유 없이 간단한 설명

**장점:**
- 화면공유 필요 없음
- 깨끗한 흰색 배경
- 큰 작업 공간 (1200x800)
- 실시간 공유
- 터치 지원

### 화면공유 중 판서 기능 ⭐ ENHANCED

화면공유 중에 공유 화면 위에 직접 그릴 수 있습니다:

**판서 시작:**
1. **화면공유** 시작 (교사 또는 학생)
2. 컨트롤 바에 **✏️ 판서** 버튼이 자동 표시됨
3. **✏️ 판서** 버튼 클릭
4. 별도 팝업 창에 판서 도구가 열림
5. 공유 중인 화면 위에 투명 캔버스 생성됨

**도구 사용 (새창):**
- **색상**: 원하는 색상 선택
- **굵기**: 슬라이더로 1~20px 조절
- **🖊️ 펜**: 그리기 모드 (기본)
- **🧹 지우개**: 판서만 지우기 (화면은 보존) ⭐ 버그 수정
- **🔴 포인터**: 붉은 점 포인터로 강조 표시
- **🗑️ 전체삭제**: 판서만 전체 삭제

**지우개 개선:**
- ✅ destination-out 모드 사용
- ✅ 판서만 지우고 배경 화면은 유지
- ✅ 투명 효과로 자연스러운 지우기
- ❌ 더 이상 화면이 흰색으로 지워지지 않음

**판서 종료:**
- **✏️ 판서** 버튼 다시 클릭
- 판서 도구 창 닫기
- 판서만 끄고 화면공유는 계속 가능

**독립적 제어:**
- 화면공유와 판서를 별도로 제어
- 판서만 끄고 화면공유 유지
- 화면공유만 끄고 판서 유지 (자동 정리)

**활용:**
- PPT 발표 중 강조
- 문서 설명 중 표시
- 웹사이트 설명 중 하이라이트
- 동영상 시청 중 주석
- 코드 리뷰 중 표시

### 녹화 기능 사용법

브라우저에서 직접 화면을 녹화합니다:

**녹화 시작:**
1. **⏺️ 녹화** 버튼 클릭
2. 녹화할 화면 선택 (전체 화면, 창, 탭)
3. 마이크 권한 허용 (음성 녹화)
4. 자동으로 녹화 시작
5. 버튼이 **⏹️ 중지**로 변경되고 빨간색으로 깜빡임

**녹화 중지:**
1. **⏹️ 중지** 버튼 클릭
2. 자동으로 파일 다운로드 시작
3. 파일명: `ezlive_recording_YYYYMMDD_HHMM.webm`

**녹화 파일 찾기:**
1. **📁 녹화폴더** 버튼 클릭
2. 브라우저 기본 다운로드 폴더 안내 확인
   - Windows: `C:\Users\사용자명\Downloads\`
   - Mac: `~/Downloads/`

**녹화 기능:**
- 화면 + 음성 동시 녹화
- WebM 형식으로 저장
- 고화질 녹화 (2.5Mbps)
- 자동 파일명 생성 (날짜_시간)
- 채팅에 녹화 시작/중지 알림

**주의사항:**
- 화면 공유 권한 필요
- 마이크 권한 필요 (음성 녹화 시)
- WebM 형식 (Chrome, Edge, Firefox 지원)
- 긴 시간 녹화 시 파일 크기 주의
- 녹화 중 화면 공유 창을 닫으면 자동 중지

### 초대링크 사용법 ⭐ 추천

초대링크를 사용하면 학생들이 훨씬 쉽게 참여할 수 있습니다!

**교사 측 (링크 생성):**
1. 강의 생성 완료
2. Step 2 화면에서 2가지 공유 방법 확인:
   - 📋 **강의 코드**: 수동 입력 방식
   - 🔗 **초대 링크**: 원클릭 참여 방식 ⭐
3. **🔗 링크 복사** 버튼 클릭
4. 학생들에게 링크 전달 (카카오톡, 이메일, 문자 등)

**학생 측 (링크 사용):**
1. 교사가 보낸 초대링크 클릭
   ```
   예시: https://your-site.com/?invitation-code=abc123xyz
   ```
2. 자동으로 강의 참여 페이지 열림
3. 강의 코드 자동 입력됨 ✅
4. **학생 이름만 입력**
5. **강의 참여** 버튼 클릭
6. 즉시 연결! 🎉

**초대링크의 장점:**
- ✅ 강의 코드 복사/붙여넣기 불필요
- ✅ 입력 실수 방지
- ✅ 학생이 이름만 입력하면 끝
- ✅ 모바일에서도 편리
- ✅ 링크 하나로 모든 정보 전달

**초대링크 형식:**
```
https://[도메인]/?invitation-code=[강의코드]
```

**공유 방법:**
- 카카오톡: 링크 복사 → 전송
- 이메일: 링크 붙여넣기
- 문자메시지: 링크 전송
- 학습관리시스템(LMS): 공지사항에 링크 게시

**⚠️ 카카오톡/인앱 브라우저 사용 시:**
- 카카오톡, 네이버, 페이스북 등의 인앱 브라우저에서는 카메라/마이크 접근이 제한될 수 있습니다
- 링크 클릭 시 **자동으로 외부 브라우저 안내 페이지** 표시
- iOS: "Safari에서 열기" 안내
- Android: "Chrome에서 열기" 안내 또는 자동 리다이렉트
- 학생들에게 외부 브라우저에서 열도록 안내해주세요

### 종료 시 채팅 저장

통화 종료 시 채팅 기록 저장 여부를 선택할 수 있습니다:

1. **❌ 종료** 버튼 클릭
2. 모달 창 표시:
   - **💾 저장하고 종료**: 채팅 기록을 CSV로 다운로드 후 종료
   - **종료만**: 저장하지 않고 바로 종료
   - **취소**: 종료 취소하고 통화 계속

**CSV 파일 형식:**
```csv
시간,보낸사람,메시지
"14:30","김선생님","안녕하세요"
"14:31","홍길동","반갑습니다"
"14:32","시스템","화면공유를 시작했습니다."
```

### 파일 전송 사용법

1. 채팅 입력란 왼쪽의 **파일전송** 버튼 클릭
2. 전송할 파일 선택 (최대 100MB)
3. 자동으로 파일 전송
4. 상대방은 다운로드 버튼으로 파일 저장

**지원 파일:**
- 이미지: JPG, PNG, GIF 등
- 문서: PDF, Word, Excel, PowerPoint
- 압축: ZIP, RAR
- 동영상: MP4, AVI (용량 제한 내)
- 기타: 모든 파일 형식

**제한사항:**
- 최대 파일 크기: 100MB
- P2P 전송으로 서버 미경유
- 연결 종료 시 파일 이력 삭제
- 대용량 파일은 전송 시간이 소요될 수 있음

## 🎯 향후 개발 계획

### 미구현 기능

- [ ] **다중 사용자**: 3명 이상 동시 연결 (서버 필요)
- [ ] **진짜 인증 시스템**: 데이터베이스 기반 사용자 관리
- [ ] **강의실 룸**: 여러 강의실 동시 운영
- [ ] **대용량 파일 전송**: 100MB 이상 파일 (청크 전송)
- [ ] **화질 설정**: 비디오 해상도/프레임레이트 조절
- [ ] **네트워크 상태 표시**: 연결 품질 실시간 모니터링
- [ ] **화이트보드**: 실시간 협업 그리기
- [ ] **손들기 기능**: 학생 질문 신호
- [ ] **출석 체크**: 참여 시간 기록
- [ ] **배경 효과**: 가상 배경, 블러

### 추천 다음 단계

1. **TURN 서버 추가**: 방화벽 환경 지원
2. **서버 기반 시스템**: 진짜 인증과 다중 사용자
3. **녹화 기능**: 강의 내용 저장
4. **파일 공유**: 자료 전송
5. **화이트보드**: 판서 기능

## 🚀 배포

웹사이트를 온라인으로 배포하려면 **Publish 탭**으로 이동하여 원클릭 배포하세요!

## 💻 개발 참고사항

### 로컬 테스트
- HTTPS 또는 localhost 환경 필요 (WebRTC/PIP 보안 요구사항)
- 두 개의 브라우저 탭 또는 다른 기기에서 테스트

### 디버깅
- 브라우저 개발자 도구 콘솔에서 연결 상태 확인
- PeerJS 이벤트 로그 확인

## 📄 라이선스

이 프로젝트는 교육 및 개인 사용 목적으로 제작되었습니다.

## 🙏 크레딧

- **PeerJS**: WebRTC 래퍼 라이브러리
- **Google STUN Servers**: NAT 통과 지원
- **WebRTC**: 실시간 통신 기술
- **Picture-in-Picture API**: 브라우저 PIP 기능

---

**제작일**: 2025-11-09  
**버전**: 4.0.0  
**개발자**: ezlive Team  
**용도**: 교육용 1:1 화상 강의 플랫폼

---

## 🎉 버전 4.0.0 변경사항 ⭐ MAJOR UPDATE

### 화이트보드 기능 추가
- ✅ **독립 판서도구 버튼**
  - 화면공유 옆에 별도 판서도구 버튼 추가
  - 언제든지 켜고 끌 수 있는 토글 기능
  - 화면공유와 독립적으로 작동

- ✅ **새창 화이트보드**
  - 1200x800 크기의 화이트보드 새창
  - 실시간 캔버스 스트림 공유
  - 상대방에게 그대로 전송
  - 펜, 지우개, 포인터, 전체삭제 도구
  - 색상 및 굵기 조절 가능

### 화면공유 중 판서 기능 개선
- ✅ **화면공유 전용 판서**
  - 화면공유 시작 시 판서 버튼 자동 표시
  - 판서 버튼으로 화면 위에 직접 그리기
  - 화면공유와 판서를 독립적으로 제어
  - 판서만 끄고 화면공유는 유지 가능

- ✅ **지우개 버그 수정**
  - destination-out 모드 사용
  - 판서만 지우고 배경 화면은 보존
  - 투명 효과로 자연스러운 지우기

### 모바일 지원 대폭 강화
- ✅ **모바일 화면공유**
  - iOS Safari, Android Chrome 지원
  - 모바일 기기 화면을 그대로 공유
  - 터치 친화적 인터페이스

- ✅ **모바일 녹화**
  - 모바일 기기에서 화면 녹화 가능
  - 시스템 오디오 캡처 시도
  - MediaRecorder API 완벽 지원

## 🎉 버전 3.0.0 변경사항 ⭐ MAJOR UPDATE

### 강의 코드 시스템 개선
- ✅ **고정 강의 코드** PeerID 고정값 사용
  - 교사가 원하는 강의 코드 직접 입력
  - 빈칸으로 두면 랜덤 8자리 자동 생성
  - 같은 코드로 항상 접속 가능
  - 중복 코드 자동 감지 및 경고 (unavailable-id 에러)

- ✅ **localStorage 자동 저장**
  - 교사 이름, 비밀번호, 강의 코드 자동 저장
  - 다음 접속 시 자동으로 불러오기
  - 편리한 재사용

### 판서 기능 대폭 개선
- ✅ **수동 실행**
  - 화면공유 시 자동 표시 X
  - ✏️ 판서 버튼 클릭으로 수동 실행
  - 필요할 때만 사용

- ✅ **새창 모드**
  - 판서 도구를 별도 팝업 창으로 띄우기
  - 항상 위에 표시되어 가리지 않음
  - 전체화면/최대화에서도 사용 가능
  - 자유로운 위치 조정

- ✅ **포인터 기능**
  - 🔴 붉은 점 포인터 추가
  - 마우스/터치 이동 시만 표시
  - 그리지 않고 강조만 할 때 유용
  - 발표 중 특정 부분 지적

### 모바일 최적화 유지
- ✅ toolbar는 이미 flex, nowrap, overflow-x 설정 완료
- ✅ 모바일 반응형 완벽 지원

## 🎉 버전 2.6.0 변경사항 ⭐ MOBILE UPDATE

### 모바일 반응형 완성
- ✅ **모바일 컨트롤 바** 가로 스크롤 최적화
  - 버튼 가로 배치, 스크롤 가능
  - 아이콘 + 레이블 명확한 표시
  - 터치 친화적 크기 (60px → 50px on 480px)
  - 스크롤바 숨김 처리

- ✅ **모바일 비디오 레이아웃** 세로 스택
  - 상대방 화면 위, 내 화면 아래
  - 16:9 aspect-ratio 자동 조절
  - max-height 제한 (40vh / 30vh)
  - 전체화면 모드 100vw x 100vh

- ✅ **모바일 채팅창** 슬라이드업
  - 하단 고정, 탭하여 열기/닫기
  - 60px 미리보기 표시
  - "👆 탭하여 열기" 힌트 표시
  - 전체화면 시 하단 40vh 고정

- ✅ **비디오 자동재생 처리**
  - playVideoSafely() 함수 추가
  - 모바일 자동재생 정책 대응
  - 재생 실패 시 수동 재생 버튼 표시
  - NotAllowedError 핸들링

- ✅ **모바일 전체화면 최적화**
  - window.innerWidth 감지
  - 모바일: 채팅창 하단 배치
  - 데스크톱: 채팅창 우측 배치
  - ESC 키로 나가기

- ✅ **판서 도구 모바일 위치**
  - 하단 우측 고정 (bottom: 80px)
  - 터치 이벤트 완벽 지원
  - 모바일 화면에 맞춘 크기

- ✅ **README 모바일 가이드 추가**
  - 모바일 접속 방법
  - 컨트롤 바 사용법
  - 채팅창 슬라이드업
  - 터치 조작 가이드
  - 문제 해결 팁

### 버전 2.5.1 기능
- ✅ **인앱 브라우저 감지 및 리다이렉트**
  - 카카오톡 인앱 브라우저 자동 감지
  - 네이버, 페이스북, 인스타그램, 라인 앱 감지
  - iOS: Safari 열기 안내 페이지 자동 표시
  - Android: Chrome 자동 리다이렉트 (intent:// 스킴)
  - 카메라/마이크 권한 문제 사전 방지

### 버전 2.5.0 기능
- ✅ **초대링크 시스템** ⭐ NEW
  - URL query parameter 기반 초대링크 생성
  - 교사가 강의 생성 시 자동 생성
  - 초대링크 원클릭 복사
  - 학생이 링크 클릭 시 간소화된 UI
  - 강의 코드 입력 생략
  - 이름만 입력하고 바로 참여
  - 형식: `https://your-site.com/?invitation-code=PEER_ID`
  - **인앱 브라우저 자동 감지** ⭐ NEW
    - 카카오톡, 네이버, 페이스북, 인스타그램, 라인 감지
    - iOS: Safari 열기 안내 페이지 표시
    - Android: Chrome 자동 리다이렉트 또는 안내
    - 카메라/마이크 권한 문제 해결

### 이전 버전 기능 (v2.4.0)
- ✅ **판서 기능** ⭐ NEW
  - 화면공유 중 실시간 그리기 기능
  - 색상 선택기 (컬러 픽커)
  - 굵기 조절 (1~20px)
  - 펜/지우개 모드 전환
  - 전체 삭제 버튼
  - 마우스 및 터치 지원

- ✅ **화면공유 알림 시스템** ⭐ NEW
  - 화면공유 시작 시 채팅에 시스템 메시지
  - 화면공유 종료 시 채팅에 시스템 메시지
  - 상대방에게도 실시간 알림 전송

- ✅ **종료 시 채팅 저장 확인** ⭐ NEW
  - 통화 종료 버튼 클릭 시 모달 표시
  - 💾 저장하고 종료
  - 종료만
  - 취소

- ✅ **녹화 기능** ⭐ NEW
  - 브라우저 내장 녹화 기능 (MediaRecorder API)
  - 화면 + 음성 동시 녹화
  - WebM 형식 자동 저장
  - 녹화 시작/중지 버튼
  - 실시간 녹화 상태 표시 (빨간색 깜빡임)
  - 자동 파일명 생성 (날짜_시간)
  - 다운로드 폴더 안내
  - 채팅에 녹화 시작/중지 알림

### v2.3.0 기능
- ✅ **학생 화면공유 승인 시스템**
  - 학생이 화면공유 버튼 클릭 시 교사에게 자동 요청
  - 교사에게 승인/거부 모달 표시
  - 교사 승인 후 학생이 화면공유 시작
  - 거부 시 학생에게 알림
  - 채팅창에 승인/거부 내역 표시
  - 교사는 승인 없이 즐시 화면공유 가능

### 이전 버전 기능 (v2.2.0)
- ✅ **교사/학생 이름 입력 기능**
  - 강의 생성/참여 시 이름 입력 필수
  - 비디오 화면에 실제 이름 표시
  - 채팅 메시지에 보낸 사람 이름 표시
- ✅ **채팅창 토글 버튼**
  - 채팅창을 닫았다 다시 열 수 있음
  - 컨트롤 바에 채팅창 버튼 추가
- ✅ **다시보기 버튼**
  - LMS 버튼 옆에 위치
  - https://jlive.co.kr/ 링크 연결

### 기존 버그 수정 (v2.1.1)
- ✅ 파일 전송 기능 오류 수정
- ✅ 채팅 전체화면 모드 오류 수정
- ✅ 채팅 새창 열기 기능 오류 수정
- ✅ PIP 모드 오류 수정
- ✅ 비디오 최대화/최소화 오류 수정
- ✅ JavaScript null reference 오류 수정
- ✅ 모든 버튼에 null 체크 추가 (안정성 향상)
