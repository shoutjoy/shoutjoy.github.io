<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ezlive - P2P í™”ìƒ ê°•ì˜</title>
    <link rel="stylesheet" href="css/style.css">
    
    <!-- ì¹´ì¹´ì˜¤í†¡/ì¸ì•± ë¸Œë¼ìš°ì € ê°ì§€ ë° ì™¸ë¶€ ë¸Œë¼ìš°ì € ì—´ê¸° -->
    <script>
        (function() {
            const userAgent = navigator.userAgent.toLowerCase();
            const currentUrl = window.location.href;
            
            // ì¹´ì¹´ì˜¤í†¡ ì¸ì•± ë¸Œë¼ìš°ì € ê°ì§€
            const isKakaoTalk = userAgent.indexOf('kakaotalk') > -1;
            
            // ë„¤ì´ë²„ ì¸ì•± ë¸Œë¼ìš°ì € ê°ì§€
            const isNaver = userAgent.indexOf('naver') > -1;
            
            // í˜ì´ìŠ¤ë¶ ì¸ì•± ë¸Œë¼ìš°ì € ê°ì§€
            const isFacebook = userAgent.indexOf('fban') > -1 || userAgent.indexOf('fbav') > -1;
            
            // ì¸ìŠ¤íƒ€ê·¸ë¨ ì¸ì•± ë¸Œë¼ìš°ì € ê°ì§€
            const isInstagram = userAgent.indexOf('instagram') > -1;
            
            // ë¼ì¸ ì¸ì•± ë¸Œë¼ìš°ì € ê°ì§€
            const isLine = userAgent.indexOf('line') > -1;
            
            // ê¸°íƒ€ ì¸ì•± ë¸Œë¼ìš°ì €
            const isInAppBrowser = isKakaoTalk || isNaver || isFacebook || isInstagram || isLine;
            
            if (isInAppBrowser) {
                // ëª¨ë°”ì¼ í™˜ê²½ì¸ì§€ í™•ì¸
                const isMobile = /android|iphone|ipad|ipod/i.test(userAgent);
                
                if (isMobile) {
                    // iOSì¸ ê²½ìš°
                    if (/iphone|ipad|ipod/i.test(userAgent)) {
                        // iOSëŠ” intent ìŠ¤í‚´ì´ ì—†ìœ¼ë¯€ë¡œ ì•ˆë‚´ í˜ì´ì§€ í‘œì‹œ
                        showOpenInBrowserGuide('iOS');
                    } 
                    // Androidì¸ ê²½ìš°
                    else if (/android/i.test(userAgent)) {
                        // Android Chromeìœ¼ë¡œ ì—´ê¸° ì‹œë„
                        const intentUrl = 'intent://' + currentUrl.replace(/https?:\/\//, '') + '#Intent;scheme=https;package=com.android.chrome;end';
                        window.location.href = intentUrl;
                        
                        // 1ì´ˆ í›„ì—ë„ í˜ì´ì§€ê°€ ê·¸ëŒ€ë¡œë©´ ì•ˆë‚´ í‘œì‹œ
                        setTimeout(function() {
                            showOpenInBrowserGuide('Android');
                        }, 1000);
                    }
                } else {
                    // ë°ìŠ¤í¬í†± í™˜ê²½
                    showOpenInBrowserGuide('Desktop');
                }
            }
            
            function showOpenInBrowserGuide(platform) {
                // ê¸°ì¡´ ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
                document.addEventListener('DOMContentLoaded', function() {
                    const container = document.querySelector('.container');
                    if (container) {
                        container.style.display = 'none';
                    }
                    
                    // ì•ˆë‚´ í˜ì´ì§€ ìƒì„±
                    const guideDiv = document.createElement('div');
                    guideDiv.id = 'inAppBrowserGuide';
                    guideDiv.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; z-index: 999999;';
                    
                    let guideContent = '';
                    
                    if (platform === 'iOS') {
                        guideContent = `
                            <div style="background: white; padding: 40px; border-radius: 20px; max-width: 90%; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
                                <h2 style="color: #667eea; margin-bottom: 20px; font-size: 1.8rem;">ğŸ”— ì™¸ë¶€ ë¸Œë¼ìš°ì €ì—ì„œ ì—´ê¸°</h2>
                                <p style="color: #666; margin-bottom: 30px; line-height: 1.6;">
                                    ì¹´ë©”ë¼ì™€ ë§ˆì´í¬ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´<br>
                                    Safari ë¸Œë¼ìš°ì €ì—ì„œ ì—´ì–´ì£¼ì„¸ìš”!
                                </p>
                                <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: left;">
                                    <p style="font-weight: 600; margin-bottom: 10px; color: #333;">ğŸ“± iOS ì‚¬ìš© ë°©ë²•:</p>
                                    <ol style="padding-left: 20px; color: #666; line-height: 2;">
                                        <li>ìš°ì¸¡ í•˜ë‹¨ <strong>ê³µìœ </strong> ë²„íŠ¼ (â†—ï¸) í´ë¦­</li>
                                        <li><strong>Safariì—ì„œ ì—´ê¸°</strong> ì„ íƒ</li>
                                    </ol>
                                </div>
                                <p style="font-size: 0.9rem; color: #999;">ë˜ëŠ” ì£¼ì†Œë¥¼ ë³µì‚¬í•˜ì—¬ Safariì— ì§ì ‘ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”</p>
                            </div>
                        `;
                    } else if (platform === 'Android') {
                        guideContent = `
                            <div style="background: white; padding: 40px; border-radius: 20px; max-width: 90%; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
                                <h2 style="color: #667eea; margin-bottom: 20px; font-size: 1.8rem;">ğŸ”— ì™¸ë¶€ ë¸Œë¼ìš°ì €ì—ì„œ ì—´ê¸°</h2>
                                <p style="color: #666; margin-bottom: 30px; line-height: 1.6;">
                                    ì¹´ë©”ë¼ì™€ ë§ˆì´í¬ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´<br>
                                    Chrome ë¸Œë¼ìš°ì €ì—ì„œ ì—´ì–´ì£¼ì„¸ìš”!
                                </p>
                                <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: left;">
                                    <p style="font-weight: 600; margin-bottom: 10px; color: #333;">ğŸ“± Android ì‚¬ìš© ë°©ë²•:</p>
                                    <ol style="padding-left: 20px; color: #666; line-height: 2;">
                                        <li>ìš°ì¸¡ ìƒë‹¨ <strong>â‹®</strong> (ë”ë³´ê¸°) í´ë¦­</li>
                                        <li><strong>ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ì—ì„œ ì—´ê¸°</strong> ì„ íƒ</li>
                                        <li><strong>Chrome</strong> ì„ íƒ</li>
                                    </ol>
                                </div>
                                <button onclick="navigator.clipboard.writeText('${currentUrl}').then(() => alert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! Chromeì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.'))" 
                                        style="background: #667eea; color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1rem; cursor: pointer; margin-top: 10px;">
                                    ğŸ“‹ ë§í¬ ë³µì‚¬í•˜ê¸°
                                </button>
                            </div>
                        `;
                    } else {
                        guideContent = `
                            <div style="background: white; padding: 40px; border-radius: 20px; max-width: 90%; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
                                <h2 style="color: #667eea; margin-bottom: 20px; font-size: 1.8rem;">ğŸ”— ì™¸ë¶€ ë¸Œë¼ìš°ì €ì—ì„œ ì—´ê¸°</h2>
                                <p style="color: #666; margin-bottom: 30px; line-height: 1.6;">
                                    ì›í™œí•œ ì‚¬ìš©ì„ ìœ„í•´<br>
                                    ê¸°ë³¸ ë¸Œë¼ìš°ì €ì—ì„œ ì—´ì–´ì£¼ì„¸ìš”!
                                </p>
                                <p style="font-size: 0.9rem; color: #999;">ë”ë³´ê¸° ë©”ë‰´ì—ì„œ "ì™¸ë¶€ ë¸Œë¼ìš°ì €ì—ì„œ ì—´ê¸°"ë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
                            </div>
                        `;
                    }
                    
                    guideDiv.innerHTML = guideContent;
                    document.body.appendChild(guideDiv);
                });
            }
        })();
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¥ ezlive</h1>
            <p>P2P í™”ìƒ ì±„íŒ… ì• í”Œë¦¬ì¼€ì´ì…˜</p>
        </header>

        <!-- ì»¨íŠ¸ë¡¤ ë°” (í—¤ë” ì•„ë˜ ë°°ì¹˜, step3ì—ì„œë§Œ í‘œì‹œ) -->
        <div id="controlsBar" class="controls-bar" style="display: none;">
            <button id="toggleVideoBtn" class="btn-control-bar" title="ë¹„ë””ì˜¤ ë„ê¸°/ì¼œê¸°">
                <span class="icon">ğŸ“¹</span>
                <span class="label">ë¹„ë””ì˜¤</span>
            </button>
            <button id="toggleAudioBtn" class="btn-control-bar" title="ë§ˆì´í¬ ë„ê¸°/ì¼œê¸°">
                <span class="icon">ğŸ¤</span>
                <span class="label">ë§ˆì´í¬</span>
            </button>
            <button id="shareScreenBtn" class="btn-control-bar" title="í™”ë©´ ê³µìœ ">
                <span class="icon">ğŸ–¥ï¸</span>
                <span class="label">í™”ë©´ê³µìœ </span>
            </button>
            <button id="whiteboardBtn" class="btn-control-bar btn-whiteboard" title="íŒì„œë„êµ¬ (í™”ì´íŠ¸ë³´ë“œ)">
                <span class="icon">âœï¸</span>
                <span class="label">íŒì„œë„êµ¬</span>
            </button>
            <button id="toggleChatViewBtn" class="btn-control-bar" title="ì±„íŒ…ì°½ ì—´ê¸°/ë‹«ê¸°">
                <span class="icon">ğŸ’¬</span>
                <span class="label">ì±„íŒ…ì°½</span>
            </button>
            <button id="downloadChatBtn" class="btn-control-bar" title="ì±„íŒ… ê¸°ë¡ ë‹¤ìš´ë¡œë“œ">
                <span class="icon">ğŸ’¾</span>
                <span class="label">ì±„íŒ…ì €ì¥</span>
            </button>
            <button id="lmsBtn" class="btn-control-bar btn-lms" title="LMS ë°”ë¡œê°€ê¸°">
                <span class="icon">ğŸ“</span>
                <span class="label">LMS</span>
            </button>
            <button id="replayBtn" class="btn-control-bar btn-replay" title="ë‹¤ì‹œë³´ê¸°">
                <span class="icon">ğŸ”„</span>
                <span class="label">ë‹¤ì‹œë³´ê¸°</span>
            </button>
            <button id="recordBtn" class="btn-control-bar btn-record" title="ë…¹í™” ì‹œì‘/ì¤‘ì§€">
                <span class="icon">âºï¸</span>
                <span class="label">ë…¹í™”</span>
            </button>
            <button id="recordFolderBtn" class="btn-control-bar btn-folder" title="ë…¹í™” í´ë” ì—´ê¸°">
                <span class="icon">ğŸ“</span>
                <span class="label">ë…¹í™”í´ë”</span>
            </button>
            <button id="endCallBtn" class="btn-control-bar btn-danger" title="í†µí™” ì¢…ë£Œ">
                <span class="icon">âŒ</span>
                <span class="label">ì¢…ë£Œ</span>
            </button>
        </div>

        <!-- Step 1: ì„œë²„ ìƒì„± -->
        <div id="step1" class="step active">
            <div class="card">
                <h2>ğŸ« êµì‚¬ìš© í™”ìƒê°•ì˜ ìƒì„±</h2>
                <p>ê°•ì˜ë¥¼ ìƒì„±í•˜ê³  í•™ìƒë“¤ì„ ì´ˆëŒ€í•˜ì„¸ìš”.</p>
                <input type="text" id="teacherName" placeholder="êµì‚¬ ì´ë¦„ ì…ë ¥" class="input">
                <input type="password" id="teacherPassword" placeholder="êµì‚¬ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" class="input">
                <input type="text" id="teacherClassCode" placeholder="ê°•ì˜ ì½”ë“œ ì…ë ¥ (ë¹„ì›Œë‘ë©´ ìë™ìƒì„±)" class="input">
                <p class="hint">ğŸ’¡ ê°•ì˜ ì½”ë“œë¥¼ ë¹„ì›Œë‘ë©´ ëœë¤ìœ¼ë¡œ ìë™ ìƒì„±ë©ë‹ˆë‹¤</p>
                <button id="createHostBtn" class="btn btn-primary">ê°•ì˜ ìƒì„±</button>
                
                <div class="divider">ë˜ëŠ”</div>
                
                <h2>ğŸ“ í•™ìƒìš© ê°•ì˜ì°¸ì—¬</h2>
                <p>êµì‚¬ê°€ ê³µìœ í•œ ê°•ì˜ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
                <input type="text" id="studentName" placeholder="í•™ìƒ ì´ë¦„ ì…ë ¥" class="input">
                <input type="text" id="joinPeerId" placeholder="ê°•ì˜ ì½”ë“œ ì…ë ¥" class="input">
                <button id="joinBtn" class="btn btn-secondary">ê°•ì˜ ì°¸ì—¬</button>
            </div>
        </div>

        <!-- Step 2: ì„œë²„ ì£¼ì†Œ ê³µìœ  -->
        <div id="step2" class="step">
            <div class="card">
                <h2>2ï¸âƒ£ ê°•ì˜ ì½”ë“œ ê³µìœ í•˜ê¸°</h2>
                <p>ì•„ë˜ ì½”ë“œë¥¼ í•™ìƒë“¤ì—ê²Œ ê³µìœ í•˜ì„¸ìš”.</p>
                
                <div class="share-box">
                    <div class="peer-id-display">
                        <strong>ê°•ì˜ ì½”ë“œ:</strong>
                        <div id="myPeerId" class="peer-id"></div>
                    </div>
                    <button id="copyBtn" class="btn btn-copy">ğŸ“‹ ì½”ë“œ ë³µì‚¬</button>
                </div>

                <div class="divider">ë˜ëŠ”</div>

                <div class="share-box invitation-box">
                    <div class="peer-id-display">
                        <strong>ğŸ”— ì´ˆëŒ€ ë§í¬:</strong>
                        <div id="invitationLink" class="invitation-link"></div>
                    </div>
                    <button id="copyInvitationBtn" class="btn btn-copy">ğŸ”— ë§í¬ ë³µì‚¬</button>
                </div>
                <p class="invitation-note">ğŸ’¡ ì´ˆëŒ€ ë§í¬ë¥¼ ì‚¬ìš©í•˜ë©´ í•™ìƒì´ ì´ë¦„ë§Œ ì…ë ¥í•˜ê³  ë°”ë¡œ ì°¸ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p>

                <div class="status-box">
                    <div id="connectionStatus">í•™ìƒì˜ ì ‘ì†ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...</div>
                </div>
            </div>
        </div>

        <!-- Step 3: í™”ìƒ ì±„íŒ… -->
        <div id="step3" class="step">
            <div class="main-layout" id="mainLayout">
                <div class="video-container" id="videoContainer">
                    <div class="video-wrapper" id="remoteVideoWrapper">
                        <video id="remoteVideo" autoplay playsinline></video>
                        <div class="video-label">ìƒëŒ€ë°©</div>
                        <div class="video-controls">
                            <button id="remotePipBtn" class="btn-video-control" title="PIP ëª¨ë“œ">
                                <span class="icon">ğŸ–¼ï¸</span>
                            </button>
                            <button id="remoteMaximizeBtn" class="btn-video-control" title="ìµœëŒ€í™”/ìµœì†Œí™”">
                                <span class="icon">â¤¢</span>
                            </button>
                            <button id="fullscreenBtn" class="btn-video-control" title="ì „ì²´í™”ë©´">
                                <span class="icon">â›¶ï¸</span>
                            </button>
                        </div>
                    </div>
                    <div class="video-wrapper local" id="localVideoWrapper">
                        <video id="localVideo" autoplay playsinline muted></video>
                        <div class="video-label">ë‚˜</div>
                        <div class="video-controls">
                            <button id="localPipBtn" class="btn-video-control" title="ë‚´ í™”ë©´ PIP">
                                <span class="icon">ğŸ–¼ï¸</span>
                            </button>
                            <button id="localMaximizeBtn" class="btn-video-control" title="ìµœëŒ€í™”/ìµœì†Œí™”">
                                <span class="icon">â¤¢</span>
                            </button>
                            <button id="localFullscreenBtn" class="btn-video-control" title="ì „ì²´í™”ë©´">
                                <span class="icon">â›¶ï¸</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="chat-container" id="chatContainer">
                    <div class="chat-header">
                        <h3>ğŸ’¬ ì±„íŒ…</h3>
                        <div class="chat-header-actions">
                            <button id="screenShareDrawingBtn" class="btn-icon" title="íŒì„œë„êµ¬ (í™”ë©´ê³µìœ  ì¤‘)" style="display: none;">âœï¸</button>
                            <button id="fullscreenChatBtn" class="btn-icon" title="ì±„íŒ… ì „ì²´í™”ë©´">â›¶ï¸</button>
                            <button id="popoutChatBtn" class="btn-icon" title="ìƒˆì°½ìœ¼ë¡œ ì—´ê¸°">ğŸ——ï¸</button>
                            <button id="closeChatBtn" class="btn-close mobile-only">âœ•</button>
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <input type="file" id="fileInput" style="display: none;">
                        <button id="fileBtn" class="btn btn-file" title="íŒŒì¼ ì „ì†¡">íŒŒì¼ì „ì†¡</button>
                        <input type="text" id="chatInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." class="chat-input">
                        <button id="sendBtn" class="btn btn-send">ì „ì†¡</button>
                    </div>
                    <div id="chatMessages" class="chat-messages"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- í™”ë©´ê³µìœ  ìŠ¹ì¸ ìš”ì²­ ëª¨ë‹¬ -->
    <div id="screenShareRequestModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>ğŸ“¢ í™”ë©´ê³µìœ  ìš”ì²­</h3>
            <p id="requestMessage">í•™ìƒì´ í™”ë©´ê³µìœ ë¥¼ ìš”ì²­í–ˆìŠµë‹ˆë‹¤.</p>
            <div class="modal-buttons">
                <button id="approveScreenShareBtn" class="btn btn-approve">âœ… ìŠ¹ì¸</button>
                <button id="rejectScreenShareBtn" class="btn btn-reject">âŒ ê±°ë¶€</button>
            </div>
        </div>
    </div>

    <!-- ì¢…ë£Œ ì‹œ ì±„íŒ… ì €ì¥ í™•ì¸ ëª¨ë‹¬ -->
    <div id="endCallModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>ğŸ“ í†µí™” ì¢…ë£Œ</h3>
            <p>ì±„íŒ… ê¸°ë¡ì„ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            <div class="modal-buttons">
                <button id="saveChatAndEndBtn" class="btn btn-approve">ğŸ’¾ ì €ì¥í•˜ê³  ì¢…ë£Œ</button>
                <button id="endWithoutSaveBtn" class="btn btn-secondary">ì¢…ë£Œë§Œ</button>
                <button id="cancelEndBtn" class="btn btn-reject">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- íŒì„œ ë„êµ¬ (í™”ë©´ê³µìœ  ì¤‘ì—ë§Œ í‘œì‹œ) -->
    <div id="drawingTools" class="drawing-tools" style="display: none;">
        <div class="drawing-tools-header">
            <span>ğŸ–Šï¸ íŒì„œ ë„êµ¬</span>
            <button id="closeDrawingBtn" class="btn-close-drawing">âœ•</button>
        </div>
        <div class="drawing-tools-body">
            <label>ìƒ‰ìƒ:</label>
            <input type="color" id="drawColor" value="#ff0000">
            
            <label>êµµê¸°:</label>
            <input type="range" id="drawWidth" min="1" max="20" value="3">
            <span id="widthValue">3</span>
            
            <button id="penBtn" class="btn-tool active">ğŸ–Šï¸ íœ</button>
            <button id="eraserBtn" class="btn-tool">ğŸ§¹ ì§€ìš°ê°œ</button>
            <button id="pointerBtn" class="btn-tool">ğŸ”´ í¬ì¸í„°</button>
            <button id="clearDrawingBtn" class="btn-tool">ğŸ—‘ï¸ ì „ì²´ì‚­ì œ</button>
        </div>
    </div>

    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
